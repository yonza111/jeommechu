{% extends 'base.html' %}

{% block title %}
    근처 식당
{% endblock %}

{% block content %}
    <h2>Restaurants Near You</h2>

    <!-- 사용자에게 위치 설정 옵션 제공 -->
    <p>
        <button id="use-current-location">Use Current Location</button>
        또는
        <label for="latitude">Latitude:</label>
        <input type="text" id="latitude" placeholder="Enter latitude">
        <label for="longitude">Longitude:</label>
        <input type="text" id="longitude" placeholder="Enter longitude">
        <button id="set-location">Set Location</button>
    </p>

    <ul id="restaurant-list">
        <!-- 레스토랑 리스트가 여기에 동적으로 추가됩니다 -->
    </ul>

    <script>
        // API에 요청 보내기
        function fetchRestaurants(latitude, longitude) {
            console.log('Fetching restaurants for:', latitude, longitude);  // 콘솔에 좌표 출력
            fetch('/maps/api/restaurants_nearby/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    latitude: latitude,
                    longitude: longitude
                })
            })
            .then(response => response.json())
            .then(data => {
                const restaurantList = document.getElementById('restaurant-list');
                restaurantList.innerHTML = '';  // 리스트 초기화
    
                // 받은 데이터를 리스트로 출력
                data.forEach(restaurant => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<a href="${restaurant.link}">${restaurant.title}</a> - ${restaurant.address}`;
                    restaurantList.appendChild(listItem);
                });
            })
            .catch(error => {
                console.error('Error fetching restaurants:', error);
            });
        }
    
        // 현재 위치 가져오기 (Geolocation API)
        document.getElementById('use-current-location').addEventListener('click', function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    console.log('Current Location:', latitude, longitude);  // 콘솔에 현재 위치 출력
                    fetchRestaurants(latitude, longitude);  // 위치 기반으로 음식점 데이터 요청
                }, function(error) {
                    console.error('Error getting current location:', error);
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        });
    
        // 사용자가 설정한 위치로 음식점 검색
        document.getElementById('set-location').addEventListener('click', function() {
            const latitude = document.getElementById('latitude').value;
            const longitude = document.getElementById('longitude').value;
            console.log('Set Location:', latitude, longitude);  // 콘솔에 입력한 위치 출력
            if (latitude && longitude) {
                fetchRestaurants(latitude, longitude);  // 사용자가 입력한 위치로 음식점 데이터 요청
            } else {
                alert('Please enter both latitude and longitude.');
            }
        });
    </script>
{% endblock %}
